!function(){var t,e,n,r,o;t=e={events:{mousedown:function(t){return this.mod.contenteditable.drag=!1},mousemove:function(t){if(1===t.buttons)return this.mod.contenteditable.drag=!0},keydown:function(t){return r.call(this,t)},click:function(t){return n.call(this,{target:t.target,x:t.clientX,y:t.clientY})},keyup:function(t){if(27===t.which)return e.setEditable.call(this,{target:null})}},init:function(){var t,n,r=this;return this.mod.contenteditable={},function(){var r,o=[];for(t in r=e.events)n=r[t],o.push({k:t,v:n});return o}().map(function(t){var e,n;return e=t.k,n=t.v,document.addEventListener(e,function(t){return n.call(r,t)})})}},t.setEditable=n=function(t){var e,n,r,o,i,a,d,l,c,s,u;return e=t.target,n=t.x,r=t.y,o=this.mod.contenteditable,i=o.ct,o.ct=Date.now(),a=null!=i?o.ct-i:1e3,d=ld$.parent(e,"[editable]"),ld$.parent(d,null,this.root)||(d=null),o.lock&&o.active!==d&&(d=null),o.active&&o.active!==d&&o.active.setAttribute("contenteditable",!1),!o.active&&d&&this.fire("focus",{node:d}),o.active=d,d?(d.setAttribute("contenteditable",!0),(a<=250||o.drag)&&(l=window.getSelection()).rangeCount&&(c=l.getRangeAt(0),!l.isCollapsed&&c.toString().length&&ld$.parent(c.commonAncestorContainer,null,o.active)&&(s=c)),s||(ld$.find(d,"[editable]").map(function(t){return t.setAttribute("contenteditable",!1)}),s=ldCaret.byPtr({node:d,x:n,y:r}).range),(u=s.endContainer)&&u.hasAttribute&&u.hasAttribute("editable")&&s.setEndBefore(u),ldCaret.set(s)):this.fire("blur")},r=function(t){var e,n,r,o,i,a;if(e=t.target,window.getSelection&&8===t.which&&(n=window.getSelection()).isCollapsed&&n.rangeCount&&!((r=n.getRangeAt(n.rangeCount-1)).commonAncestorContainer.nodeType===Element.TEXT_NODE&&r.startOffset>0)){if(r=document.createRange(),n.anchorNode!==e)r.selectNodeContents(e),r.setEndBefore(n.anchorNode);else{if(!(n.anchorOffset>0))return;r.setEnd(e,n.anchorOffset)}if(r.endOffset)r.setStart(e,r.endOffset-1);else{for(o=r.endContainer;o&&o.parentNode&&!((i=Array.from(o.parentNode.childNodes).indexOf(o))>0);)o=o.parentNode;if(!o)return;r.setStart(o.parentNode,i-1),r.setEnd(o.parentNode,i)}return(a=r.cloneContents().lastChild)&&"false"===a.contentEditable?(r.deleteContents(),event.preventDefault()):void 0}},((o=window.editable).mod||(o.mod={})).register("contenteditable",e)}();