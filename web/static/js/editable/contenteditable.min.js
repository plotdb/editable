!function(){var t,e,n,r;t=e={events:{mousedown:function(t){return this.mod.contenteditable.drag=!1},mousemove:function(t){if(1===t.buttons)return this.mod.contenteditable.drag=!0},keydown:function(t){return r.call(this,t)},click:function(t){return n.call(this,{target:t.target,x:t.clientX,y:t.clientY})},keyup:function(t){if(27===t.which)return e.setEditable.call(this,{target:null})}},init:function(){var t,n,r=this;return this.mod.contenteditable={},function(){var r,o=[];for(t in r=e.events)n=r[t],o.push({k:t,v:n});return o}().map(function(t){var e,n;return e=t.k,n=t.v,document.addEventListener(e,function(t){return n.call(r,t)})})}},t.setEditable=n=function(e){var n,r,o,i,a,d,l,c,s,u,f;return n=e.target,r=e.x,o=e.y,i=this.mod.contenteditable,a=t.ct,t.ct=Date.now(),d=null!=a?t.ct-a:1e3,l=ld$.parent(n,"[editable]"),ld$.parent(l,null,this.root)||(l=null),i.lock&&i.active!==l&&(l=null),i.active&&i.active!==l&&i.active.setAttribute("contenteditable",!1),!i.active&&l&&this.fire("focus",{node:l}),i.active=l,l?(l.setAttribute("contenteditable",!0),(d<=250||i.drag)&&(c=window.getSelection()).rangeCount&&(s=c.getRangeAt(0),!c.isCollapsed&&s.toString().length&&ld$.parent(s.commonAncestorContainer,null,i.active)&&(u=s)),u||(ld$.find(l,"[editable]").map(function(t){return t.setAttribute("contenteditable",!1)}),u=ldCaret.byPtr({node:l,x:r,y:o}).range),(f=u.endContainer)&&f.hasAttribute&&f.hasAttribute("editable")&&u.setEndBefore(f),ldCaret.set(u)):this.fire("blur")},r=function(t){var e,n,r,o,i,a;if(e=t.target,window.getSelection&&8===t.which&&(n=window.getSelection()).isCollapsed&&n.rangeCount&&!((r=n.getRangeAt(n.rangeCount-1)).commonAncestorContainer.nodeType===Element.TEXT_NODE&&r.startOffset>0)){if(r=document.createRange(),n.anchorNode!==e)r.selectNodeContents(e),r.setEndBefore(n.anchorNode);else{if(!(n.anchorOffset>0))return;r.setEnd(e,n.anchorOffset)}if(r.endOffset)r.setStart(e,r.endOffset-1);else{for(o=r.endContainer;o&&o.parentNode&&!((i=Array.from(o.parentNode.childNodes).indexOf(o))>0);)o=o.parentNode;if(!o)return;r.setStart(o.parentNode,i-1),r.setEnd(o.parentNode,i)}return(a=r.cloneContents().lastChild)&&"false"===a.contentEditable?(r.deleteContents(),event.preventDefault()):void 0}},window.contenteditable=e}();