!function(){var e,t,n,o,i;e=t={events:{mousedown:function(e){return this.mod.contenteditable.drag=!1},mousemove:function(e){if(1===e.buttons)return this.mod.contenteditable.drag=!0},keydown:function(e){return o.call(this,e)},click:function(e){return n.call(this,{target:e.target,x:e.clientX,y:e.clientY})},keyup:function(e){if(27===e.which)return t.setEditable.call(this,{target:null})}},init:function(){return this.mod.contenteditable={}}},e.setEditable=n=function(e){var t,n,o,i,r,a,d,l,c,s,u;return t=e.target,n=e.x,o=e.y,i=this.mod.contenteditable,r=i.ct,i.ct=Date.now(),a=null!=r?i.ct-r:1e3,d=ld$.parent(t,"[editable]"),ld$.parent(d,null,this.root)||(d=null),i.lock&&i.active!==d&&(d=null),i.active&&i.active!==d&&i.active.setAttribute("contenteditable",!1),!i.active&&d&&this.fire("focus",{node:d}),i.active=d,d?(d.setAttribute("contenteditable",!0),(a<=250||i.drag)&&(l=window.getSelection()).rangeCount&&(c=l.getRangeAt(0),!l.isCollapsed&&c.toString().length&&ld$.parent(c.commonAncestorContainer,null,i.active)&&(s=c)),s||(ld$.find(d,"[editable]").map(function(e){return e.setAttribute("contenteditable",!1)}),s=ldCaret.byPtr({node:d,x:n,y:o}).range),(u=s.endContainer)&&u.hasAttribute&&u.hasAttribute("editable")&&s.setEndBefore(u),ldCaret.set(s)):this.fire("blur")},o=function(e){var t,n,o,i,r,a;if(t=e.target,window.getSelection&&8===e.which&&(n=window.getSelection()).isCollapsed&&n.rangeCount&&!((o=n.getRangeAt(n.rangeCount-1)).commonAncestorContainer.nodeType===Element.TEXT_NODE&&o.startOffset>0)){if(o=document.createRange(),n.anchorNode!==t)o.selectNodeContents(t),o.setEndBefore(n.anchorNode);else{if(!(n.anchorOffset>0))return;o.setEnd(t,n.anchorOffset)}if(o.endOffset)o.setStart(t,o.endOffset-1);else{for(i=o.endContainer;i&&i.parentNode&&!((r=Array.from(i.parentNode.childNodes).indexOf(i))>0);)i=i.parentNode;if(!i)return;o.setStart(i.parentNode,r-1),o.setEnd(i.parentNode,r)}return(a=o.cloneContents().lastChild)&&"false"===a.contentEditable?(o.deleteContents(),event.preventDefault()):void 0}},((i=window.editable).mod||(i.mod={})).register("contenteditable",t)}();