function import$(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}!function(){var t,e,r;t={events:{mousedown:function(t){var e;if(this.mod.dragger.contains(t.target)){for(e=t.target;e&&(!e.hasAttribute||!e.hasAttribute("draggable"));)e=e.parentNode;return e?e.setAttribute("draggable",!0):void 0}},dragstart:function(e){var r;return r=this.mod.dragger,r.src=e.target,e.dataTransfer.setData("application/json",JSON.stringify({})),e.dataTransfer.setDragImage(t.ghost,10,10),r.setDrag(!0),e.stopPropagation()},dragover:function(t){var e,r;if(t.preventDefault(),e=this.mod.dragger,r=ldCaret.byPtr({node:this.root,x:t.clientX,y:t.clientY,method:"euclidean"}),e.contains(r.range.startContainer))return e.render({range:r.range})},drop:function(t){var e,r;return e=[t.target,this.mod.dragger],r=e[1],t.preventDefault(),r.drop({evt:t})}},ghost:(e=new Image,e.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n<rect x="0" y="0" width="20" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),e),init:function(){return this.mod.dragger=new r({root:this.root,editable:this})}},r=function(t){var e;return null==t&&(t={}),this.editable=t.editable,this.opt=t,e=t.root,this.root=e="string"==typeof e?document.querySelector(e):e||null,import$(this,{dragging:!1,caret:null,src:null}),this.caret={box:null,range:null},this.evtHandler={},this.init(),this},r.prototype=import$(Object.create(Object.prototype),{init:function(){return this.caret.box=document.createElement("div"),this.caret.box.classList.add("mod-dragger-caret"),document.body.appendChild(this.caret.box)},contains:function(t){return this.root.contains(t)},setDrag:function(t){return this.dragging=t},typematch:function(t){var e,r,n,a;return e=t.n,r=t.p,e&&r?(n=0,a=e?getComputedStyle(e).display:void 0,r.hasAttribute("hostable")&&!/inline/.exec(a)&&(n+=1),r.hasAttribute("editable")&&"false"!==r.getAttribute("editable")&&/inline/.exec(a)&&(n+=2),n):0},render:function(t){var e,r,n,a,i;return null==t&&(t={}),(e=t.range)?(n=ld$.parent(e.startContainer,"[hostable],[editable]:not([editable=false])",this.root),a=this.typematch({p:n,n:this.src}),i=e.getBoundingClientRect(),this.caret.range=e,import$(this.caret.box.style,{left:i.x+"px",top:i.y+"px",height:i.height+"px",display:"block",opacity:a?1:.4,filter:a?"":"saturate(0)"})):(r=this.caret.box.style,r.display="none",r)},drop:function(t){var e,r,n,a,i,o,s,d,l,c,g,h=this;if(e=t.evt,r=this.caret.range,this.render(),r&&this.root.contains(e.target)&&(n=ld$.parent(r.startContainer,"[hostable],[editable]:not([editable=false])",this.root))){if(a=r.startContainer,i=r.startOffset,o=a.nodeType===Element.TEXT_NODE?a:a.childNodes[i],s=this.src){if(ld$.parent(o,null,s))return;if(!(c=this.typematch({p:n,n:s})))return;if(1&c)for(;o&&o.parentNode!==n;)o=o.parentNode;return o.nodeType===Element.TEXT_NODE?(s.parentNode.removeChild(s),g=o.textContent,[document.createTextNode(g.substring(0,i)),s,document.createTextNode(g.substring(i))].map(function(t){return o.parentNode.insertBefore(t,o)}),o.parentNode.removeChild(o)):(s.parentNode.removeChild(s),o.parentNode.insertBefore(s,o)),this.editable.fire("change")}return"block"===(d=(l=e.dataTransfer.getData("application/json"))?JSON.parse(l):{}).type?blocktmp.get({name:d.data.name}).then(function(t){return deserialize(t)}).then(function(t){return o.parentNode.insertBefore(t.node,o),h.editable.fire("change")}).catch(function(t){return console.log(t)}):void 0}}}),((e=window.editable).mod||(e.mod={})).register("dragger",t)}();