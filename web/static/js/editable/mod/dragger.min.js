function import$(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}!function(){var t,e,r;t={events:{mousedown:function(t){var e;if(this.mod.dragger.contains(t.target)){for(e=t.target;e&&(!e.hasAttribute||!e.hasAttribute("draggable"));)e=e.parentNode;return e?e.setAttribute("draggable",!0):void 0}},dragstart:function(e){var r,n,i,a;if(this.mod.dragger.contains(e.target))return r=this.mod.dragger,r.src=e.target,n=/inline/.exec(getComputedStyle(r.src).display)?"inline":"block",i={mode:n},(a=e.dataTransfer).setData("application/json",JSON.stringify(i)),a.setData("mode/"+n,""),a.setDragImage(t.ghost[n],10,10),r.setDrag(!0),e.stopPropagation()},dragover:function(t){var e,r,n,i,a;if(t.preventDefault(),e=this.mod.dragger,r=ldCaret.byPtr({node:this.root,x:t.clientX,y:t.clientY,method:"euclidean"}),e.contains(r.range.startContainer))return n=t.dataTransfer.types.map(function(t){return/mode\/(.+)/.exec(t)}).filter(function(t){return t}).map(function(t){return t[1]})[0]||"inline",e.render((a={},a.range=r.range,i=a,i.mode=n,i))},drop:function(t){var e,r;return e=[t.target,this.mod.dragger],r=e[1],t.preventDefault(),r.drop({evt:t})}},ghost:{block:(e=new Image,e.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n<rect x="0" y="0" width="9" height="15" fill="rgba(0,0,0,.5)"/>\n<rect x="11" y="0" width="9" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),e),inline:(e=new Image,e.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n<rect x="0" y="0" width="20" height="3" fill="rgba(0,0,0,.5)"/>\n<rect x="0" y="4" width="20" height="3" fill="rgba(0,0,0,.5)"/>\n<rect x="0" y="8" width="20" height="3" fill="rgba(0,0,0,.5)"/>\n<rect x="0" y="12" width="20" height="3" fill="rgba(0,0,0,.5)"/>\n</svg>'),e)},init:function(){return this.mod.dragger=new r({root:this.root,editable:this})}},r=function(t){var e;return null==t&&(t={}),this.editable=t.editable,this.opt=t,e=t.root,this.root=e="string"==typeof e?document.querySelector(e):e||null,import$(this,{dragging:!1,caret:null,src:null}),this.caret={box:null,range:null},this.evtHandler={},this.init(),this},r.prototype=import$(Object.create(Object.prototype),{init:function(){return this.caret.box=document.createElement("div"),this.caret.box.classList.add("mod-dragger-caret"),document.body.appendChild(this.caret.box)},contains:function(t){return this.root.contains(t)},setDrag:function(t){return this.dragging=t},hostmatch:function(t){var e,r,n;for(e=t.parent,r=t.mode;e;){if(e.hasAttribute&&(n=0,"block"===r&&e.hasAttribute("hostable")&&(n+=1),"inline"===r&&e.hasAttribute("editable")&&"false"!==e.getAttribute("editable")&&(n+=2),n))return{parent:e,type:n};(e=e.parentNode)===this.root&&(e=null)}return{parent:e,type:n}},render:function(t){var e,r,n,i,a;return null==t&&(t={}),(e=t.range)?((r=this.hostmatch({parent:e.startContainer,mode:t.mode})).parent,n=r.type,i=n,a=e.getBoundingClientRect(),this.caret.range=e,import$(this.caret.box.style,{left:a.x+"px",top:a.y+"px",height:a.height+"px",display:"block",opacity:i?1:.4,filter:i?"":"saturate(0)"})):(r=this.caret.box.style,r.display="none",r)},drop:function(t){var e,r,n,i,a,o,d,s,l,g=this;if(e=t.evt,r=[this.caret.range,this.src],n=r[0],i=r[1],this.src=null,this.render(),n&&this.root.contains(e.target))return a=n.startContainer,o=e.dataTransfer.types.map(function(t){return/mode\/(.+)/.exec(t)}).filter(function(t){return t}).map(function(t){return t[1]})[0]||"inline",i?this.insert({range:n,parent:a,mode:o,node:i}):(d=(s=e.dataTransfer.getData("application/json"))?JSON.parse(s):{},console.log(d),"block"===d.type?(l=function(){var t;return t=document.createElement("div"),t.innerText="Hello World!",{node:t}},datadom.deserialize(d.dom,l).then(function(t){var e;return(e=t.node).setAttribute("editable",!0),e.setAttribute("draggable",!0),g.insert({range:n,parent:a,node:t.node,mode:d.mode||"block"})})):((i=document.createElement("block"===d.mode?"div":"span")).setAttribute("editable",!0),i.setAttribute("draggable",!0),datadom.deserialize(d.dom).then(function(t){return i.innerHTML="",i.appendChild(t.node)}),this.insert({range:n,parent:a,node:i,mode:d.mode||"block"})))},insert:function(t){var e,r,n,i,a,o,d,s,l,g,c,h,u,p,m;if(e=t.parent,r=t.range,n=t.node,i=t.mode,a=[e,r,n,i],o=a[0],a[1],d=a[2],s=a[3],l=r.startContainer,g=r.startOffset,c=l.nodeType===Element.TEXT_NODE?l:l.childNodes[g],!ld$.parent(c,null,d)&&(a=this.hostmatch({parent:o,mode:s}),e=a.parent,h=a.type,o=e)){if(1&h)for(;c&&c.parentNode!==o;)c=c.parentNode;return c.nodeType===Element.TEXT_NODE?(d.parentNode&&d.parentNode.removeChild(d),u=c.textContent,[document.createTextNode(u.substring(0,g)),d,document.createTextNode(u.substring(g))].map(function(t){return c.parentNode.insertBefore(t,c)}),c.parentNode.removeChild(c)):(d.parentNode&&d.parentNode.removeChild(d),"block"===i?(p=document.createRange(),m=document.createRange(),p.setStart(o,0),p.setEnd(l,g),m.setStart(l,g),m.setEnd(o.nextSibling||o,o.nextSibling?0:o.childNodes?o.childNodes.length:o.textContent.length),p.toString().length>m.toString().length?c.parentNode.insertBefore(d,c.nextSibling):c.parentNode.insertBefore(d,c)):c.parentNode.insertBefore(d,c)),this.editable.fire("change")}}}),((e=window.editable).mod||(e.mod={})).register("dragger",t)}();